도면 ROI 기반 격자 좌표 생성기 (Meter-scale)
========================================

본 도구는 도면 이미지에서 사용자가 직접 관심 영역(ROI)을 지정하고,
해당 영역 내부의 좌표를 미터(m) 단위 격자로 생성하여 CSV 파일로 출력하는
인터랙티브 좌표 생성 도구입니다.

실내 위치추정(PDR, AI-PDR, Surface Correlation, BLE/Wi-Fi Fingerprinting 등)
연구에서 후보 좌표 생성 및 기준 격자 구성을 목적으로 제작되었습니다.


--------------------------------------------------
주요 기능
--------------------------------------------------
- 도면 이미지 확대 / 축소 / 이동(Pan) 지원
- 실제 치수 기반 픽셀 → 미터 스케일 변환
- 임의 다각형 ROI(관심 영역) 직접 지정
- ROI 내부 균일 격자 좌표 생성 (기본 1m 간격)
- 한글 안내문 지원 (PIL 기반)
- CSV 출력 (수학 좌표계 기준, +Y 위쪽)


--------------------------------------------------
마우스 및 키 조작법
--------------------------------------------------
확대 / 축소        : 마우스 휠
화면 이동(Pan)     : 우클릭 드래그
점 추가            : 좌클릭
마지막 점 취소     : Ctrl + Z 또는 Z
단계 완료          : Enter
프로그램 종료      : ESC


--------------------------------------------------
전체 사용 흐름
--------------------------------------------------

[STEP 1] 캘리브레이션 (총 4점 클릭)

1) 실제 길이를 알고 있는 치수선의 양 끝 2점
2) 원점으로 사용할 점 (0, 0)
3) X축 방향을 나타내는 점 (원점 기준 오른쪽)

위 과정을 통해 픽셀 → 미터 변환 스케일 및 좌표계가 설정됩니다.


[STEP 2] ROI(관심 영역) 지정

- ROI 외곽을 따라 꼭짓점을 순서대로 클릭
- 최소 3점 이상
- Enter 키로 완료

주의:
- 반드시 외곽선을 따라 순서대로 찍어야 합니다.
- 점 순서가 꼬이거나 자기 교차가 발생하면
  ROI 내부 판정이 비정상적으로 동작할 수 있습니다.


[STEP 3] 격자 좌표 생성

- 지정된 ROI 내부에 대해 미터 단위 격자 생성
- 기본 간격: 1.0 m
- 결과를 CSV 파일로 저장


--------------------------------------------------
출력 결과
--------------------------------------------------

1) CSV 파일
   파일명 예시: roi_grid_points_1m.csv

   형식:
   X_m, Y_m
   0.0, 0.0
   1.0, 0.0
   1.0, 1.0
   ...

2) 좌표계 기준
   - X축: 오른쪽이 +
   - Y축: 위쪽이 + (수학 / ENU 좌표계)

   내부 계산은 OpenCV 이미지 좌표계(y 아래 증가)를 사용하며,
   CSV 저장 직전에 Y좌표에 -1을 곱해 위쪽이 +가 되도록 변환합니다.


--------------------------------------------------
설치 방법
--------------------------------------------------

Python 3.x 환경에서 아래 패키지가 필요합니다.

- opencv-python
- numpy
- pandas
- Pillow

설치 예시:
pip install opencv-python numpy pandas Pillow


--------------------------------------------------
실행 방법
--------------------------------------------------

python generate_roi_grid.py


스크립트 상단 주요 설정값:

IMAGE_PATH      : 도면 이미지 경로
KNOWN_LENGTH_M  : 실제 치수 길이 (미터 단위)
GRID_M          : 격자 간격 (미터 단위)


--------------------------------------------------
설계 메모 (중요)
--------------------------------------------------

- 모든 좌표 변환 및 ROI 판정은 이미지 좌표계 기준으로 수행됩니다.
- CSV 저장 단계에서만 Y좌표를 뒤집어
  연구 및 시각화에 바로 사용할 수 있는 좌표계로 출력합니다.
- ROI 판정에는 OpenCV의 pointPolygonTest를 사용합니다.


--------------------------------------------------
활용 예시
--------------------------------------------------

- AI-PDR 학습용 기준 격자 생성
- BLE / Wi-Fi Fingerprinting 후보 지점 생성
- Surface Correlation 기준 좌표 구성
- 실내 실험 경로 설계 및 시각화


--------------------------------------------------
라이선스
--------------------------------------------------

MIT License

자유롭게 사용, 수정, 배포 가능합니다.
연구 및 랩실 내부 공유 용도로 사용을 권장합니다.

